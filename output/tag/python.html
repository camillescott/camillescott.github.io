<!DOCTYPE html>
<html lang="en">
<head>
				<title>At the Mountains of Madness &mdash; Articles tagged python</title>
		<meta charset="utf-8" />
		<link rel="profile" href="http://gmpg.org/xfn/11" />
		<link rel="stylesheet" type="text/css" href="http://miskatonic.ged.msu.edu/theme/css/style.css" />
		<link rel='stylesheet' id='oswald-css'  href='http://fonts.googleapis.com/css?family=Oswald&#038;ver=3.3.2' type='text/css' media='all' />
		<style type="text/css">
			body.custom-background { background-color: #f5f5f5; }
		</style>
		<link rel="alternate" type="application/atom+xml"
			title="At the Mountains of Madness â€” Flux Atom"
			href="http://miskatonic.ged.msu.edu/" /> 
				<!--[if lte IE 8]><script src="http://miskatonic.ged.msu.edu/theme/js/html5shiv.js"></script><![endif]-->
				</head>

<body class="home blog custom-background " >
	<div id="container">
		<div id="header">
				<h1 id="site-title"><a href="http://miskatonic.ged.msu.edu">At the Mountains of Madness</a></h1>
				<h2 id="site-description">a blog on the perils and wonders of bioinformatics</h2>		</div><!-- /#banner -->
		
		<div id="menu">
			<div class="menu-navigation-container">
				<ul id="menu-navigation" class="menu">
										  										  						<li class="menu-item menu-item-type-post_type menu-item-object-page"><a href="http://miskatonic.ged.msu.edu/category/python.html">python</a></li>
					  						<li class="menu-item menu-item-type-post_type menu-item-object-page"><a href="http://miskatonic.ged.msu.edu/category/science.html">science</a></li>
					  															  						<li  class="active" class="menu-item menu-item-type-post_type menu-item-object-page"><a href="http://ged.msu.edu/">GED Lab</a></li>
					  						<li  class="active" class="menu-item menu-item-type-post_type menu-item-object-page"><a href="http://ivory.idyll.org/blog/">Titus Brown</a></li>
					  					
				</ul>
			</div> <!--/#menu-navigation-container-->
		</div><!-- /#menu -->
		
		<div class="page-title">
			<div class="page-title">
	<h2>Tagged with <span>python</span> &hellip;</h2>
</div>
		</div>
	
		<div id="contents">
						<div class="post type-post status-publish format-standard hentry category-general" id="post">
	<div class="entry-meta">
		<div class="date"><a href="http://miskatonic.ged.msu.edu/profiling-with-yep.html">Fri 06 December 2013</a></div>
				<span class="byline">By <a href="http://miskatonic.ged.msu.edu/author/c-scott.html">C Scott</a></span>
									<span class="cat-links"><a href="http://miskatonic.ged.msu.edu/category/python.html" title="View all posts in python" rel="category tag">python</a></span>
			</div> <!-- /#entry-meta -->
	<div class="main">
		<h2 class="entry-title">
			<a href="http://miskatonic.ged.msu.edu/profiling-with-yep.html" title="Permalink to Profiling C++ Extensions with Yep" rel="bookmark">Profiling C++ Extensions with Yep</a>
		</h2>
		<div class="entry-content">
			<p>For those of you who work with both the python codebase and the <tt class="docutils literal">c++</tt> backend, I found a pretty useful tool.
Seeing as we work with performance-sensitive software, profiling is very useful; but, it can be a pain
to profile our <tt class="docutils literal">c++</tt> code when called through python, which necessitates writing <tt class="docutils literal">c++</tt> wrappers
to functions for basic profiling. The solution I found is called
<a class="reference external" href="(http://fa.bianp.net/blog/2011/a-profiler-for-python-extensions">yep</a>,
which is a python module made specifically to profile <tt class="docutils literal">c++</tt> python extensions. In order to install, simply run:</p>
<pre class="literal-block">
sudo apt-get install google-perftools
sudo apt-get install python-dbg
pip install yep
</pre>
<p>For khmer, you should also be sure to turn on debugging at compile time:</p>
<pre class="literal-block">
cd /path/to/khmer
make debug
</pre>
<p>The first is the python module implementing the profiler; the second is the tool for analyzing the resulting
profile information.</p>
<p>There are a couple ways to use it. You can call it directly from the command line with:</p>
<pre class="literal-block">
python -m yep [options] -- /path/to/script [args ... ]
</pre>
<p>The <tt class="docutils literal"><span class="pre">--</span></tt> is necessary, as it tells UNIX not to parse the resulting arguments as flag arguments, which allows
the profiler to pass them on to the script being profiled instead of choking on them itself. Thanks for
this trick, &#64;mr-c. Also make sure to use the absolute path to the script to be profiled.</p>
<p>You can also use the module directly in your code, with:</p>
<pre class="literal-block">
import yep
yep.start('outname')
&lt;code to profile...&gt;
yep.stop()
</pre>
<p>The resulting file is then visualized using google-pprof, with:</p>
<pre class="literal-block">
google-pprof --gif &lt;python executable&gt; &lt;profile&gt; &gt; prof.gif
</pre>
<p>In order to get python debugging symbols, you need to use the debugging executable. So, while you may
run the script in your virtualenv if using one, you give google-pprof the debug executable so it
can properly construct callgraphs:</p>
<pre class="literal-block">
python -m yep -- /w/khmer/scripts/sweep-reads-by-partition-buffered.py \
 -k 25 -x 1e9 -o test_sweep -i /w/tests/test-sweep-contigs.fp \
/w/tests/test-sweep-reads.fa
google-pprof --gif /usr/bin/python2.7-dbg \
 sweep-reads-by-partition-buffer.py.prof &gt; prof.gif
</pre>
<p>Here is some example output:</p>
<div class="figure align-center">
<img alt="Profile of sparse labeling extension in sweep script" src="../static/images/prof.png" style="width: 100%;" />
<p class="caption">In this call graph, the python debugging symbols were not properly included; this is resolved by using the
debuggging executable.</p>
</div>
<p>The call graph is in standard form, where the first percentange is the time in that particular
function alone, and where the second percentage is the time in all functions called by that function.
See the <a class="reference external" href="http://google-perftools.googlecode.com/svn/trunk/doc/cpuprofile.html">description</a> for more details.</p>
<p>And that's it. Happy profiling!</p>

		</div> <!--/#entry-content-->
		    		<span class="tag-links"><strong>Tagged</strong>
    			    			 <a href="http://miskatonic.ged.msu.edu/tag/c.html" rel="tag">c++</a>,  <a href="http://miskatonic.ged.msu.edu/tag/profiling.html" rel="tag">profiling</a>,  <a href="http://miskatonic.ged.msu.edu/tag/programming.html" rel="tag">programming</a>,  <a href="http://miskatonic.ged.msu.edu/tag/python.html" rel="tag">python</a>    		</span>
    		</div> <!--/#main-->
</div>  <!--/#post-->		<div class="navigation">
		</div>
		</div>
		
		<div id="footer">
			<p>Powered by <a href="http://getpelican.com">Pelican</a>, theme by <a href="http://bunnyman.info">tBunnyMan</a>.</p>
								</div><!-- /#footer -->
	</div><!-- /#container -->
	<div style="display:none"></div>
</body>
</html>